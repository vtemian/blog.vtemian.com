<!doctype html><html lang=en><head><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,minimum-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.1/styles/atom-one-light.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.1/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><meta charset=utf-8><meta name=robots content="index,follow"><link rel=canonical href=https://blog.vtemian.com/post/healthy-python-codebase/><link rel=icon type=image/svg+xml href=https://blog.vtemian.com/favicon.svg><link rel=apple-touch-icon href=https://blog.vtemian.com/favicon.svg><meta name=keywords content="python,codebase,consistency,explicit is better than implicit,end-to-end testing python,integration testing python,unit testing python,python refactoring example"><meta name=description content="Guidelines for maintaining a healthy Python codebase: consistency, explicit code, fail-fast patterns, testing strategies, and practical refactoring examples"><meta property="og:url" content="https://blog.vtemian.com/post/healthy-python-codebase/"><meta property="og:site_name" content="vtemian - blog"><meta property="og:title" content="Healthy Python Codebase"><meta property="og:description" content="Guidelines for maintaining a healthy Python codebase: consistency, explicit code, fail-fast patterns, testing strategies, and practical refactoring examples"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:published_time" content="2020-09-21T15:04:57+02:00"><meta property="article:modified_time" content="2020-09-21T15:04:57+02:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Guide"><meta property="article:tag" content="Refactoring"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Healthy Python Codebase"><meta name=twitter:description content="Guidelines for maintaining a healthy Python codebase: consistency, explicit code, fail-fast patterns, testing strategies, and practical refactoring examples"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.vtemian.com\/post\/healthy-python-codebase\/"},"headline":"Healthy Python Codebase","description":"Guidelines for maintaining a healthy Python codebase: consistency, explicit code, fail-fast patterns, testing strategies, and practical refactoring examples","inLanguage":"en-US","author":{"@type":"Person","name":"Vlad Temian"},"publisher":{"@type":"Person","name":"Vlad Temian"},"datePublished":"2020-09-21T15:04:57\u002b02:00","dateModified":"2020-09-21T15:04:57\u002b02:00","url":"https:\/\/blog.vtemian.com\/post\/healthy-python-codebase\/","wordCount":1521,"keywords":["python","guide","refactoring"]}</script><title>Healthy Python Codebase</title>
<link rel=stylesheet href=https://blog.vtemian.com/stylesheets/main.min.d39be22cf1de190b7714845fe089eb7692051a3125457f549f6e714d04e73644.css media=screen><meta name=google-site-verification content="2qk_e0y84NNSVpaorKgeNURYF9Ni3UyJvPq9GZdGEgs"></head><body><div class=container><main class=article><article><header><a href=https://blog.vtemian.com/>&larr; Go back</a><h1>Healthy Python Codebase</h1><aside class="author author--is-small"><div><h4>Vlad Temian</h4><p>21 Sep 2020</p></div></aside></header><p><p>The code is a living entity. For the majority of the time, it stays in silence and it&rsquo;s doing its job, without complaining.
But, there are these creatures, humanoid, that from time to time, will change it. Will try to fix it, adapt, or
completely remove parts of it. Those creatures tend to conserve energy and they are using pattern recognition to do so.
They observe patterns and take fast and easy decisions based on those patterns.
Because of that, this code entity needs to be structured and behave in certain patterns.</p><h2 id=consistency>Consistency</h2><p>Those patterns are grouped together in a collection called code style. Any change that doesn&rsquo;t follow the code style,
introduces inconsistency, and should be treated as a systemic disease. Maybe is a little harsh, but any code change should
avoid inconsistency. Even if the current code base has a &ldquo;special&rdquo; code style, even if some bad decisions were made, introducing
inconsistency is even worst. You&rsquo;ll have to maintain two or more styles, multiply the decisions and patterns, thus adding extra effort.</p><p>So, when reviewing any code, one should take into account the current code style. Following the current patterns and maintain
consistency is more valuable in the long run. If the current code base is not consistent, I suggest solving this issue first.
It should be an easy refactoring exercise and shouldn&rsquo;t impact the business logic.</p><p>Use formatting and linting tools and setup a CI pipeline that will run on every code change.
You can even run them as a pre-commit hook. Black for formatting and pylint / mypy for linting are the most popular tools.</p><p>From a behavioral point of view, make sure that the entities are doing what their name implies: fetch_users should return a list
of users or an empty list. It shouldn&rsquo;t compute anything or return false, true, int, or string. Be consistent with names
and obey components to respect their contract. If a component violets its contract, fail fast and visible.
Don&rsquo;t be afraid to throw exceptions or stop the business logic. Failing fast and visible will help you catch bugs
and solve inconsistency issues.</p><h2 id=explicit-is-better-than-implicit>Explicit is better than implicit</h2><p>Python is magic and allows you to abuse it. Besides that, when designing certain components, make sure that those are well
defined and their behavior is properly exposed and expected by their clients.</p><p>Avoid using generic components like Manager, Service, Data since they have a tendency of hiding complexity.
Use specific and meaningful terminology for components that are responsible for doing just one thing.
Favor small and well-defined logical units over complex ones (simple is better than complex).</p><p>Avoid implicit defaults and don&rsquo;t be afraid of exposing some implementation details:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>compute_interval</span>(start):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> time<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>compute_interval</span>(start, end<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> end <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        end <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>now()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> end <span style=color:#f92672>-</span> start
</span></span></code></pre></div><p>Leverage Python&rsquo;s functional tooling over in-place processing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter</span>(items):
</span></span><span style=display:flex><span>    new_items <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> items:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> item<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;property&#34;</span>):
</span></span><span style=display:flex><span>            new_items<span style=color:#f92672>.</span>append(item)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    new_items<span style=color:#f92672>.</span>sort()  <span style=color:#75715e># faster, in-place</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> new_items
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter</span>(items, filters<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> filters:
</span></span><span style=display:flex><span>         filters <span style=color:#f92672>=</span> [<span style=color:#66d9ef>lambda</span> item: item<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;property&#34;</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     items <span style=color:#f92672>=</span> [item <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> items
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>if</span> all([filter(item) <span style=color:#66d9ef>for</span> filter <span style=color:#f92672>in</span> filters])]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>return</span> sorted(items)  <span style=color:#75715e># slower, creates a new list</span>
</span></span></code></pre></div><p>Keep the levels of indirection small, avoid abusing metaclasses and complex OOP design:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># abstractisation just for the sake of it adds more complexity than solves real issues</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RequestValidator</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, request, validators<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>request <span style=color:#f92672>=</span> request
</span></span><span style=display:flex><span>         self<span style=color:#f92672>.</span>validators <span style=color:#f92672>=</span> valiadtors <span style=color:#f92672>or</span> [
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>lambda</span> request: <span style=color:#e6db74>&#34;foo&#34;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>POST<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;arg&#34;</span>)
</span></span><span style=display:flex><span>         ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> all([validator(self<span style=color:#f92672>.</span>request) <span style=color:#66d9ef>for</span> validator <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>validators])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> RequestValidator(request)<span style=color:#f92672>.</span>validate():
</span></span><span style=display:flex><span>    process()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># simple and concise, solves the issue is easy to read and to maintain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;foo&#34;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>POST<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;arg&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>):
</span></span><span style=display:flex><span>    process()
</span></span></code></pre></div><p>Avoid using classes as logical namespaces:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Refresh</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_token</span>(cls):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>invalidate_token</span>(cls, token):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>refresh_token</span>(cls, token):
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=fail-fast-and-visible>Fail fast and visible</h2><p>Breaking the production can be terrifying and sometimes, we tend to &ldquo;hide&rdquo; or &ldquo;swallow&rdquo; user-facing errors just to
avoid showing weakness and to give our user a sense of shaky/unfinished product.</p><p>Having bugs and errors in your codebase is a natural thing. That&rsquo;s how software grows and evolves.
The catch is to see those bugs and errors as soon as possible and to fix them.
The scariest bugs always starts with This thing just doesn&rsquo;t work. It says nothing.</p><p>Avoid catching all exceptions. Instead, try to handle as many exception paths as possible.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    content <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get()
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    content <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get()
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> ConnectTimeout:
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> RequestException:
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> RetryError:
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span></code></pre></div><p>Failing fast and visible allows you to identify the problem and fix it. But you&rsquo;ll need visibility over those exceptions. Just
failing fast may not be enough. An exception without a traceback may not be so useful to find the root cause.</p><p><a href=https://sentry.io/>Sentry</a> is the way to go. Other logging and monitoring tools will help as much:
<a href=https://www.datadoghq.com/>Datadog</a>, <a href=https://cloud.google.com/products/operations>Google Operations</a>, or
<a href=https://newrelic.com/>NewRelic</a> are just a bunch of observability tools that will make your life easier.</p><h2 id=end-to-end--integration--unit-tests>End-to-End > Integration > Unit tests</h2><p>Testing is your safety net. It allows you a free state of mind in which changes can happen easily, without regression. In theory,
at least. Most of the time, we trust too much this safety net. A close to 100% code coverage doesn&rsquo;t really mean that your changes
are not breaking the current behavior. Some code paths can be purely understood and tested.</p><p>Multiple testing methodologies will create different safety nets. A really simple and fast to obtain is one using unit tests.
Testing small and well-contained pieces of logic is easy and fast. The downside comes when those pieces are interacting with other
parts and the interaction may be broke. Some assertions about those interactions can be tested using mocks, but those are our
interpretations and assertion about the behavior and not actual behavior. Avoid trusting only unit tests and mock only if
necessary. Mock data over behavior.</p><p>Instead of mocking behavior, use a production-ready setup and try to test multiple components together. This kind of testing can
be named integration tests. Use dependency injection over global services. The setup may cost you more than the setup for unit
tests, but in the end, it&rsquo;s closer to production behavior. Usually, a small integration test is more powerful than multiple unit
tests.</p><p>Even in integration, tested behavior is limited to the components tested. A wider testing methodology would be to test the entire
stack, a request lifecycle from client to server and back. This will cost you the most, but having just one simple e2e
(end-to-end) test can pay the bill big time. This type of test usually involves spawning a production-like environment, close to
production data.</p><p>Favor End-to-End tests over Integration tests. Favor Integration tests over Unit tests. Mock data over behavior.</p><h2 id=deployable>Deployable</h2><p>Writing code is easy. But those written symbols are usually meant to run on different machines. They interact with other symbols,
alone, without your help. Even if may not be a big concern, deploying software is a big part of it. When writing code, starting
with the mindset that it should get deploy will help you with design decisions. Always start with deploying in mind. How should
data migration be handled? Does it involve downtime? Should I announce my users? How to deprecate API versions?</p><p>Beside actually releasing software, thinking about packaging and portability is also important. Dependencies should be locked and
build reproducible. A clear and consistent pipeline helps users use your software and allows developers to contribute, with
minimum pain. Don&rsquo;t be afraid to use helper scripts, Dockerfiles, Makefiles, or other tools to automate your job. Software is
always changing, so allow for this pipeline/procedure to be changing as well.</p><h2 id=refactoring-example>Refactoring Example</h2><p>Those were some small guidelines from my experience. In the end, a healthy codebase is a codebase that is easy to change.</p><p>Making a codebase healthy is not a one-time thing. Is a long and tedious process, with small incremental progress. Small
deployable changes are more sustainable, less invasive, and easier to understand.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> django.conf <span style=color:#f92672>import</span> settings
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>a</span>(b):
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>now()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        c <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(b)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> time<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> s <span style=color:#f92672>&gt;</span> settings<span style=color:#f92672>.</span>TIME:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;it took too much&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> c<span style=color:#f92672>.</span>content, c<span style=color:#f92672>.</span>status_code
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Follow PEP-8 guidelines and sort imports.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> django.conf <span style=color:#f92672>import</span> settings
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> requests.exceptions <span style=color:#f92672>import</span> RequestException
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_url</span>(url: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> url <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> isinstance(url, str):
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     rules <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>lambda</span> url: url<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;https://&#34;</span>),
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>lambda</span> url: settings<span style=color:#f92672>.</span>VALID_HOST <span style=color:#f92672>in</span> url,
</span></span><span style=display:flex><span>         <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>     ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>return</span> <span style=color:#f92672>not</span> all([rule(url) <span style=color:#66d9ef>for</span> rule <span style=color:#f92672>in</span> rules])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Naming should be meaningful and consistent.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>try_fetch</span>(url: str) <span style=color:#f92672>-&gt;</span> str: <span style=color:#75715e># Type-hinting allows tools like mypy to detect bugs.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Fail fast and visible.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> validate_url(url):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Invalid or missing url: </span><span style=color:#e6db74>{</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    start <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>now()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Avoid swallowing exceptions. If not possible, log them.</span>
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>get(url, raise_for_status<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Group conditions and their context </span>
</span></span><span style=display:flex><span>    request_duration <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>now() <span style=color:#f92672>-</span> start
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request_duration <span style=color:#f92672>&gt;</span> settings<span style=color:#f92672>.</span>MAX_REQUEST_DURATION:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add more context to errors.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>RuntimeError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Request duration excided maximum duration: </span><span style=color:#e6db74>{</span>request_duration<span style=color:#e6db74>}</span><span style=color:#e6db74>.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Check invalid usecases.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> response<span style=color:#f92672>.</span>status_code <span style=color:#f92672>!=</span> <span style=color:#ae81ff>200</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>RuntimeError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Service responded with </span><span style=color:#e6db74>{</span>response<span style=color:#f92672>.</span>status_code<span style=color:#e6db74>}</span><span style=color:#e6db74> instead of 200.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> str(response<span style=color:#f92672>.</span>content) <span style=color:#75715e># Be consistent with returning type</span>
</span></span></code></pre></div><p>Cheers üç∫!</p></p></article></main><script>hljs.initHighlightingOnLoad()</script><footer class=footer>&copy; 2026 <a href=https://github.com/vtemian>Vlad Temian</a>,
powered by <a href=https://gohugo.io/ target=_blank>Hugo</a>,
with help from <a href=https://github.com/balajmarius>&copy;balajmarius</a>.</footer></div></body></html>